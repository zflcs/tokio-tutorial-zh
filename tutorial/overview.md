# Overview

Tokio 是 Rust 编程语言的一个异步运行时。它提供了编写网络应用的构建块。它可以灵活地针对各种系统，从具有数十个核心的大型服务器到小型嵌入式设备。

Tokio 提供了以下几个高级组件：

- 多线程执行异步代码的运行时
- 异步版本的标准库
- 与生态相关的大量库

## Tokio 在项目中的角色

当你使用异步的方式来写应用时，你可以通过降低同时执行多项操作的开销，从而使得程序具有更好的扩展性。然而，异步 Rust 代码不能直接运行，你必须选择一个运行时来执行它。Tokio 库则是最广泛使用的运行时，在使用量上超越了其他所有运行时的总和。

此外，Tokio 提供了许多有用的工具。在写异步代码时，你不能使用由 Rust 标准库提供的原始的阻塞 API，必须使用异步版本的。Tokio 则提供了 Rust 标准库的阻塞 API 的异步替代版本。

## Tokio 的优势

**快速**：Tokio 建立在 Rust 编程语言的基础上，而 Rust 语言本身就很快速，因此 Tokio 也具备这一个优势。这样做的目的是为了体现 Rust 的精神，即您不应该通过手动编写等效代码来提高性能。

Tokio 具有可扩展性，它建立在 async/await 语言特性之上，其本身也是可扩展的。当处理网络时，由于延迟，处理连接的速度是有限的，因此，扩展的唯一方法就是同时处理多个连接。使用 async/await 语言特性，增加并发操作的数量的成本相当低，能够扩展处理大量并发的任务。

**可靠性**：Tokio 使用 Rust 语言构建，Rust 语言本身能够构建出可靠且高效的软件，大量的研究表明，大约 70% 的高级安全漏洞是由于内存不安全导致，使用 Rust 能够消除应用中内存不安全这一大类的漏洞。

Tokio 还十分关注提供一致且无意外的行为。Tokio 的主要目标是允许使用者部署可预测的软件，该软件将日复一日地以可靠的响应时间运行，并且不会出现不可预测的延迟峰值。

**简单**：使用 Rust 的 async/await 特性，编写一部应用的复杂度大大降低。配合 Tokio 提供的工具和大量生态，编写应用程序非常简单。

Tokio 遵循标准库的命名约定，这样可以轻松地将使用标准库编写的代码转换为使用 Tokio 编写的代码，借助 Rust 的强类型系统，轻松交付正确的代码能力是无语伦比的。

**灵活**：Tokio 提供了多个版本的运行时。包括多线程、工作窃取运行时以及轻量级、单线程运行时。每个运行时带有许多配置项，允许用户根据自己的需要进行调整。

## 何时不使用 Tokio

虽然 Tokio 对于许多需要同时做很多事情的项目很有用，但也有一些用例 Tokio 并不适合。

- 在多个线程上并行运行来加速 CPU 密集型计算。Tokio 被设计用于每个任务花费大量时间等待 IO 的 IO 密集型应用。如果应用做的事情是并行计算，则应该使用 [rayon](https://docs.rs/rayon/latest/rayon/)，尽管如此，如果需要同时执行这两项操作，仍然可以混合搭配。请参阅此[博客文章](https://ryhl.io/blog/async-what-is-blocking/#the-rayon-crate)以获取实际示例。
- 读取大量文件。尽管 Tokio 看上去对这种只需要读取大量文件的项目有用，但 Tokio 相较于原本的 threadpool 并没有什么优势。这是因为操作系统本身一般没有提供异步文件 API。
- 发送单个 web 请求。当需要同时做多件事情时，Tokio 才能带有优势。如果使用专为异步 Rust 设计的库，例如 [reqwest](https://docs.rs/reqwest/latest/reqwest/)，但不需要一次性做很多事情，那么应该使用阻塞版本的库，这会让项目更简单。当然，使用 Tokio 也能工作，但相较于阻塞 API 没有提供优势。如果库没有提供阻塞 API，请查阅[有关使用同步代码进行桥接的章节](https://tokio.rs/tokio/topics/bridging)。

## 获取帮助

无论何时，如果您遇到困难，您都可以在 [Discord](https://discord.gg/tokio) 或 [GitHub 讨论](https://github.com/tokio-rs/tokio/discussions) 中寻求帮助。不用担心问“初学者”的问题。我们都是从一个地方开始的，很乐意提供帮助。